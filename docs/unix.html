<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 11 Unix commands | Benjamin-Chung Lab Manual</title>
  <meta name="description" content="Lab practices and data science best practices" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 11 Unix commands | Benjamin-Chung Lab Manual" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Lab practices and data science best practices" />
  <meta name="github-repo" content="jadebc/lab-manual" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 11 Unix commands | Benjamin-Chung Lab Manual" />
  
  <meta name="twitter:description" content="Lab practices and data science best practices" />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="github.html"/>
<link rel="next" href="reproducible-environments.html"/>
<script src="libs/header-attrs-2.21/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Lab manual</a></li>

<li class="divider"></li>
<li><a href="index.html#welcome-to-the-benjamin-chung-lab" id="toc-welcome-to-the-benjamin-chung-lab"><span class="toc-section-number">1</span> Welcome to the Benjamin-Chung Lab!</a>
<ul>
<li><a href="index.html#about-the-lab" id="toc-about-the-lab"><span class="toc-section-number">1.1</span> About the lab</a></li>
<li><a href="index.html#about-this-lab-manual" id="toc-about-this-lab-manual"><span class="toc-section-number">1.2</span> About this lab manual</a></li>
</ul></li>
<li><a href="culture-and-conduct.html#culture-and-conduct" id="toc-culture-and-conduct"><span class="toc-section-number">2</span> Culture and conduct</a>
<ul>
<li><a href="culture-and-conduct.html#lab-culture" id="toc-lab-culture"><span class="toc-section-number">2.1</span> Lab culture</a></li>
<li><a href="culture-and-conduct.html#diversity-equity-and-inclusion" id="toc-diversity-equity-and-inclusion"><span class="toc-section-number">2.2</span> Diversity, equity, and inclusion</a></li>
<li><a href="culture-and-conduct.html#protecting-human-subjects" id="toc-protecting-human-subjects"><span class="toc-section-number">2.3</span> Protecting human subjects</a></li>
<li><a href="culture-and-conduct.html#authorship" id="toc-authorship"><span class="toc-section-number">2.4</span> Authorship</a></li>
</ul></li>
<li><a href="communication-and-coordination.html#communication-and-coordination" id="toc-communication-and-coordination"><span class="toc-section-number">3</span> Communication and coordination</a>
<ul>
<li><a href="communication-and-coordination.html#slack" id="toc-slack"><span class="toc-section-number">3.1</span> Slack</a></li>
<li><a href="communication-and-coordination.html#email" id="toc-email"><span class="toc-section-number">3.2</span> Email</a></li>
<li><a href="communication-and-coordination.html#trello" id="toc-trello"><span class="toc-section-number">3.3</span> Trello</a></li>
<li><a href="communication-and-coordination.html#google-drive" id="toc-google-drive"><span class="toc-section-number">3.4</span> Google Drive</a></li>
<li><a href="communication-and-coordination.html#stanford-medicine-box" id="toc-stanford-medicine-box"><span class="toc-section-number">3.5</span> Stanford Medicine Box</a></li>
<li><a href="communication-and-coordination.html#meetings" id="toc-meetings"><span class="toc-section-number">3.6</span> Meetings</a></li>
</ul></li>
<li><a href="reproducibility.html#reproducibility" id="toc-reproducibility"><span class="toc-section-number">4</span> Reproducibility</a>
<ul>
<li><a href="reproducibility.html#what-is-the-reproducibility-crisis" id="toc-what-is-the-reproducibility-crisis"><span class="toc-section-number">4.1</span> What is the reproducibility crisis?</a></li>
<li><a href="reproducibility.html#study-design" id="toc-study-design"><span class="toc-section-number">4.2</span> Study design</a></li>
<li><a href="reproducibility.html#register-study-protocols" id="toc-register-study-protocols"><span class="toc-section-number">4.3</span> Register study protocols</a></li>
<li><a href="reproducibility.html#write-and-register-pre-analysis-plans" id="toc-write-and-register-pre-analysis-plans"><span class="toc-section-number">4.4</span> Write and register pre-analysis plans</a></li>
<li><a href="reproducibility.html#create-reproducible-workflows" id="toc-create-reproducible-workflows"><span class="toc-section-number">4.5</span> Create reproducible workflows</a></li>
<li><a href="reproducibility.html#process-and-analyze-data-with-internal-replication-and-masking" id="toc-process-and-analyze-data-with-internal-replication-and-masking"><span class="toc-section-number">4.6</span> Process and analyze data with internal replication and masking</a></li>
<li><a href="reproducibility.html#use-reporting-checklists-with-manuscripts" id="toc-use-reporting-checklists-with-manuscripts"><span class="toc-section-number">4.7</span> Use reporting checklists with manuscripts</a></li>
<li><a href="reproducibility.html#publish-preprints" id="toc-publish-preprints"><span class="toc-section-number">4.8</span> Publish preprints</a></li>
<li><a href="reproducibility.html#publish-data-when-possible-and-replication-scripts" id="toc-publish-data-when-possible-and-replication-scripts"><span class="toc-section-number">4.9</span> Publish data (when possible) and replication scripts</a></li>
</ul></li>
<li><a href="code-repositories.html#code-repositories" id="toc-code-repositories"><span class="toc-section-number">5</span> Code repositories</a>
<ul>
<li><a href="code-repositories.html#project-structure" id="toc-project-structure"><span class="toc-section-number">5.1</span> Project Structure</a></li>
<li><a href="code-repositories.html#rproj-files" id="toc-rproj-files"><span class="toc-section-number">5.2</span> <code>.Rproj</code> files</a></li>
<li><a href="code-repositories.html#configuration-config-file" id="toc-configuration-config-file"><span class="toc-section-number">5.3</span> Configuration (‘config’) File</a></li>
<li><a href="code-repositories.html#order-files-and-directories" id="toc-order-files-and-directories"><span class="toc-section-number">5.4</span> Order Files and Directories</a></li>
<li><a href="code-repositories.html#using-bash-scripts-to-ensure-reproducibility" id="toc-using-bash-scripts-to-ensure-reproducibility"><span class="toc-section-number">5.5</span> Using Bash scripts to ensure reproducibility</a></li>
</ul></li>
<li><a href="coding-practices.html#coding-practices" id="toc-coding-practices"><span class="toc-section-number">6</span> Coding practices</a>
<ul>
<li><a href="coding-practices.html#organizing-scripts" id="toc-organizing-scripts"><span class="toc-section-number">6.1</span> Organizing scripts</a></li>
<li><a href="coding-practices.html#documenting-your-code" id="toc-documenting-your-code"><span class="toc-section-number">6.2</span> Documenting your code</a>
<ul>
<li><a href="coding-practices.html#file-headers" id="toc-file-headers"><span class="toc-section-number">6.2.1</span> File headers</a></li>
<li><a href="coding-practices.html#sections-and-subsections" id="toc-sections-and-subsections"><span class="toc-section-number">6.2.2</span> Sections and subsections</a></li>
<li><a href="coding-practices.html#code-folding" id="toc-code-folding"><span class="toc-section-number">6.2.3</span> Code folding</a></li>
<li><a href="coding-practices.html#comments-in-the-body-of-your-script" id="toc-comments-in-the-body-of-your-script"><span class="toc-section-number">6.2.4</span> Comments in the body of your script</a></li>
<li><a href="coding-practices.html#function-documentation" id="toc-function-documentation"><span class="toc-section-number">6.2.5</span> Function documentation</a></li>
</ul></li>
<li><a href="coding-practices.html#object-naming" id="toc-object-naming"><span class="toc-section-number">6.3</span> Object naming</a></li>
<li><a href="coding-practices.html#function-calls" id="toc-function-calls"><span class="toc-section-number">6.4</span> Function calls</a></li>
<li><a href="coding-practices.html#the-here-package" id="toc-the-here-package"><span class="toc-section-number">6.5</span> The here package</a></li>
<li><a href="coding-practices.html#readingsaving-data" id="toc-readingsaving-data"><span class="toc-section-number">6.6</span> Reading/Saving Data</a>
<ul>
<li><a href="coding-practices.html#rds-vs-.rdata-files" id="toc-rds-vs-.rdata-files"><span class="toc-section-number">6.6.1</span> <code>.RDS</code> vs <code>.RData</code> Files</a></li>
<li><a href="coding-practices.html#csvs" id="toc-csvs"><span class="toc-section-number">6.6.2</span> CSVs</a></li>
</ul></li>
<li><a href="coding-practices.html#integrating-box-and-dropbox" id="toc-integrating-box-and-dropbox"><span class="toc-section-number">6.7</span> Integrating Box and Dropbox</a>
<ul>
<li><a href="coding-practices.html#box" id="toc-box"><span class="toc-section-number">6.7.1</span> Box</a></li>
<li><a href="coding-practices.html#dropbox" id="toc-dropbox"><span class="toc-section-number">6.7.2</span> Dropbox</a></li>
</ul></li>
<li><a href="coding-practices.html#tidyverse" id="toc-tidyverse"><span class="toc-section-number">6.8</span> Tidyverse</a></li>
<li><a href="coding-practices.html#coding-with-r-and-python" id="toc-coding-with-r-and-python"><span class="toc-section-number">6.9</span> Coding with R and Python</a></li>
<li><a href="coding-practices.html#repeating-analyses-with-different-variations" id="toc-repeating-analyses-with-different-variations"><span class="toc-section-number">6.10</span> Repeating analyses with different variations</a>
<ul>
<li><a href="coding-practices.html#lapply-and-sapply" id="toc-lapply-and-sapply"><span class="toc-section-number">6.10.1</span> <code>lapply()</code> and <code>sapply()</code></a></li>
<li><a href="coding-practices.html#mapply-and-pmap" id="toc-mapply-and-pmap"><span class="toc-section-number">6.10.2</span> <code>mapply()</code> and <code>pmap()</code></a></li>
<li><a href="coding-practices.html#parallel-processing-with-parallel-and-future-packages" id="toc-parallel-processing-with-parallel-and-future-packages"><span class="toc-section-number">6.10.3</span> Parallel processing with <code>parallel</code> and <code>future</code> packages</a></li>
</ul></li>
<li><a href="coding-practices.html#reviewing-code" id="toc-reviewing-code"><span class="toc-section-number">6.11</span> Reviewing Code</a>
<ul>
<li><a href="coding-practices.html#creating-a-pull-request-template" id="toc-creating-a-pull-request-template"><span class="toc-section-number">6.11.1</span> Creating a Pull Request Template</a></li>
</ul></li>
</ul></li>
<li><a href="coding-style.html#coding-style" id="toc-coding-style"><span class="toc-section-number">7</span> Coding style</a>
<ul>
<li><a href="coding-style.html#comments" id="toc-comments"><span class="toc-section-number">7.1</span> Comments</a></li>
<li><a href="coding-style.html#line-breaks" id="toc-line-breaks"><span class="toc-section-number">7.2</span> Line breaks</a></li>
<li><a href="coding-style.html#automated-tools-for-style-and-project-workflow" id="toc-automated-tools-for-style-and-project-workflow"><span class="toc-section-number">7.3</span> Automated Tools for Style and Project Workflow</a>
<ul>
<li><a href="coding-style.html#styling" id="toc-styling"><span class="toc-section-number">7.3.1</span> Styling</a></li>
</ul></li>
</ul></li>
<li><a href="working-with-big-data.html#working-with-big-data" id="toc-working-with-big-data"><span class="toc-section-number">8</span> Working with Big Data</a>
<ul>
<li><a href="working-with-big-data.html#the-data.table-package" id="toc-the-data.table-package"><span class="toc-section-number">8.1</span> The data.table package</a></li>
<li><a href="working-with-big-data.html#using-downsampled-data" id="toc-using-downsampled-data"><span class="toc-section-number">8.2</span> Using downsampled data</a></li>
<li><a href="working-with-big-data.html#optimal-rstudio-set-up" id="toc-optimal-rstudio-set-up"><span class="toc-section-number">8.3</span> Optimal RStudio set up</a></li>
</ul></li>
<li><a href="data-masking.html#data-masking" id="toc-data-masking"><span class="toc-section-number">9</span> Data masking</a>
<ul>
<li><a href="data-masking.html#general-overview" id="toc-general-overview"><span class="toc-section-number">9.1</span> General Overview</a>
<ul>
<li><a href="data-masking.html#what-is-data-masking" id="toc-what-is-data-masking"><span class="toc-section-number">9.1.1</span> What is Data Masking?</a></li>
<li><a href="data-masking.html#using-tidy-evaluation-for-data-masking" id="toc-using-tidy-evaluation-for-data-masking"><span class="toc-section-number">9.1.2</span> Using tidy evaluation for data masking</a></li>
</ul></li>
<li><a href="data-masking.html#technical-overview" id="toc-technical-overview"><span class="toc-section-number">9.2</span> Technical Overview</a>
<ul>
<li><a href="data-masking.html#example" id="toc-example"><span class="toc-section-number">9.2.1</span> Example</a></li>
</ul></li>
</ul></li>
<li><a href="github.html#github" id="toc-github"><span class="toc-section-number">10</span> Github</a>
<ul>
<li><a href="github.html#basics" id="toc-basics"><span class="toc-section-number">10.1</span> Basics</a></li>
<li><a href="github.html#github-desktop" id="toc-github-desktop"><span class="toc-section-number">10.2</span> Github Desktop</a></li>
<li><a href="github.html#git-branching" id="toc-git-branching"><span class="toc-section-number">10.3</span> Git Branching</a></li>
<li><a href="github.html#example-workflow" id="toc-example-workflow"><span class="toc-section-number">10.4</span> Example Workflow</a></li>
<li><a href="github.html#commonly-used-git-commands" id="toc-commonly-used-git-commands"><span class="toc-section-number">10.5</span> Commonly Used Git Commands</a></li>
<li><a href="github.html#how-often-should-i-commit" id="toc-how-often-should-i-commit"><span class="toc-section-number">10.6</span> How often should I commit?</a></li>
<li><a href="github.html#what-should-be-pushed-to-github" id="toc-what-should-be-pushed-to-github"><span class="toc-section-number">10.7</span> What should be pushed to Github?</a></li>
</ul></li>
<li><a href="unix.html#unix" id="toc-unix"><span class="toc-section-number">11</span> Unix commands</a>
<ul>
<li><a href="unix.html#basics-1" id="toc-basics-1"><span class="toc-section-number">11.1</span> Basics</a></li>
<li><a href="unix.html#syntax-for-both-macwindows" id="toc-syntax-for-both-macwindows"><span class="toc-section-number">11.2</span> Syntax for both Mac/Windows</a></li>
<li><a href="unix.html#running-bash-scripts" id="toc-running-bash-scripts"><span class="toc-section-number">11.3</span> Running Bash Scripts</a></li>
<li><a href="unix.html#running-rscripts-in-windows" id="toc-running-rscripts-in-windows"><span class="toc-section-number">11.4</span> Running Rscripts in Windows</a>
<ul>
<li><a href="unix.html#common-mistakes" id="toc-common-mistakes"><span class="toc-section-number">11.4.1</span> Common Mistakes</a></li>
</ul></li>
<li><a href="unix.html#checking-tasks-and-killing-jobs" id="toc-checking-tasks-and-killing-jobs"><span class="toc-section-number">11.5</span> Checking tasks and killing jobs</a></li>
<li><a href="unix.html#running-big-jobs" id="toc-running-big-jobs"><span class="toc-section-number">11.6</span> Running big jobs</a>
<ul>
<li><a href="unix.html#example-code-for-runfilesavelogs" id="toc-example-code-for-runfilesavelogs"><span class="toc-section-number">11.6.1</span> Example code for <code>runfileSaveLogs</code></a></li>
<li><a href="unix.html#example-usage-for-runfilesavelogs" id="toc-example-usage-for-runfilesavelogs"><span class="toc-section-number">11.6.2</span> Example usage for <code>runfileSaveLogs</code></a></li>
</ul></li>
</ul></li>
<li><a href="reproducible-environments.html#reproducible-environments" id="toc-reproducible-environments"><span class="toc-section-number">12</span> Reproducible Environments</a>
<ul>
<li><a href="reproducible-environments.html#package-version-control-with-renv" id="toc-package-version-control-with-renv"><span class="toc-section-number">12.1</span> Package Version Control with renv</a>
<ul>
<li><a href="reproducible-environments.html#introduction" id="toc-introduction"><span class="toc-section-number">12.1.1</span> Introduction</a></li>
<li><a href="reproducible-environments.html#implementing-renv-in-projects" id="toc-implementing-renv-in-projects"><span class="toc-section-number">12.1.2</span> Implementing renv in projects</a></li>
<li><a href="reproducible-environments.html#using-projects-with-renv" id="toc-using-projects-with-renv"><span class="toc-section-number">12.1.3</span> Using projects with renv</a></li>
</ul></li>
</ul></li>
<li><a href="code-publication.html#code-publication" id="toc-code-publication"><span class="toc-section-number">13</span> Code Publication</a>
<ul>
<li><a href="code-publication.html#checklist-overview" id="toc-checklist-overview"><span class="toc-section-number">13.1</span> Checklist overview</a></li>
<li><a href="code-publication.html#fill-out-file-headers" id="toc-fill-out-file-headers"><span class="toc-section-number">13.2</span> Fill out file headers</a></li>
<li><a href="code-publication.html#clean-up-comments" id="toc-clean-up-comments"><span class="toc-section-number">13.3</span> Clean up comments</a></li>
<li><a href="code-publication.html#document-functions" id="toc-document-functions"><span class="toc-section-number">13.4</span> Document functions</a></li>
<li><a href="code-publication.html#remove-deprecated-filepaths" id="toc-remove-deprecated-filepaths"><span class="toc-section-number">13.5</span> Remove deprecated filepaths</a></li>
<li><a href="code-publication.html#ensure-project-runs-via-bash" id="toc-ensure-project-runs-via-bash"><span class="toc-section-number">13.6</span> Ensure project runs via bash</a></li>
<li><a href="code-publication.html#complete-the-readme" id="toc-complete-the-readme"><span class="toc-section-number">13.7</span> Complete the README</a></li>
<li><a href="code-publication.html#clean-up-feature-branches" id="toc-clean-up-feature-branches"><span class="toc-section-number">13.8</span> Clean up feature branches</a></li>
<li><a href="code-publication.html#create-github-release" id="toc-create-github-release"><span class="toc-section-number">13.9</span> Create Github release</a></li>
</ul></li>
<li><a href="data-publication.html#data-publication" id="toc-data-publication"><span class="toc-section-number">14</span> Data Publication</a>
<ul>
<li><a href="data-publication.html#overview" id="toc-overview"><span class="toc-section-number">14.1</span> Overview</a></li>
<li><a href="data-publication.html#removing-phi" id="toc-removing-phi"><span class="toc-section-number">14.2</span> Removing PHI</a>
<ul>
<li><a href="data-publication.html#personal-information" id="toc-personal-information"><span class="toc-section-number">14.2.1</span> Personal information</a></li>
<li><a href="data-publication.html#dates" id="toc-dates"><span class="toc-section-number">14.2.2</span> Dates</a></li>
<li><a href="data-publication.html#geographic-information" id="toc-geographic-information"><span class="toc-section-number">14.2.3</span> Geographic information</a></li>
</ul></li>
<li><a href="data-publication.html#create-public-ids" id="toc-create-public-ids"><span class="toc-section-number">14.3</span> Create public IDs</a>
<ul>
<li><a href="data-publication.html#rationale" id="toc-rationale"><span class="toc-section-number">14.3.1</span> Rationale</a></li>
<li><a href="data-publication.html#a-single-set-of-public-ids-for-each-study" id="toc-a-single-set-of-public-ids-for-each-study"><span class="toc-section-number">14.3.2</span> A single set of public IDs for each study</a></li>
<li><a href="data-publication.html#example-scripts" id="toc-example-scripts"><span class="toc-section-number">14.3.3</span> Example scripts</a></li>
</ul></li>
<li><a href="data-publication.html#create-a-data-repository" id="toc-create-a-data-repository"><span class="toc-section-number">14.4</span> Create a data repository</a>
<ul>
<li><a href="data-publication.html#steps-for-creating-an-open-science-framework-osf-repository" id="toc-steps-for-creating-an-open-science-framework-osf-repository"><span class="toc-section-number">14.4.1</span> Steps for creating an Open Science Framework (OSF) repository:</a></li>
</ul></li>
<li><a href="data-publication.html#edit-and-test-analysis-scripts" id="toc-edit-and-test-analysis-scripts"><span class="toc-section-number">14.5</span> Edit and test analysis scripts</a></li>
<li><a href="data-publication.html#create-a-public-github-page-for-public-scripts" id="toc-create-a-public-github-page-for-public-scripts"><span class="toc-section-number">14.6</span> Create a public GitHub page for public scripts</a></li>
<li><a href="data-publication.html#go-live" id="toc-go-live"><span class="toc-section-number">14.7</span> Go live</a></li>
</ul></li>
<li><a href="slurm.html#slurm" id="toc-slurm"><span class="toc-section-number">15</span> Slurm and cluster computing</a>
<ul>
<li><a href="slurm.html#getting-started" id="toc-getting-started"><span class="toc-section-number">15.1</span> Getting started</a>
<ul>
<li><a href="slurm.html#one-time-system-set-up" id="toc-one-time-system-set-up"><span class="toc-section-number">15.1.1</span> One-Time System Set-Up</a></li>
</ul></li>
<li><a href="slurm.html#moving-files-to-sherlock" id="toc-moving-files-to-sherlock"><span class="toc-section-number">15.2</span> Moving files to Sherlock</a></li>
<li><a href="slurm.html#installing-packages-on-sherlock" id="toc-installing-packages-on-sherlock"><span class="toc-section-number">15.3</span> Installing packages on Sherlock</a></li>
<li><a href="slurm.html#testing-your-code" id="toc-testing-your-code"><span class="toc-section-number">15.4</span> Testing your code</a>
<ul>
<li><a href="slurm.html#the-command-line" id="toc-the-command-line"><span class="toc-section-number">15.4.1</span> The command line</a></li>
<li><a href="slurm.html#the-sherlock-ondemand-dashboard" id="toc-the-sherlock-ondemand-dashboard"><span class="toc-section-number">15.4.2</span> The Sherlock OnDemand Dashboard</a></li>
<li><a href="slurm.html#filepaths-configuration-on-sherlock" id="toc-filepaths-configuration-on-sherlock"><span class="toc-section-number">15.4.3</span> Filepaths &amp; configuration on Sherlock</a></li>
</ul></li>
<li><a href="slurm.html#storage-group-storage-access" id="toc-storage-group-storage-access"><span class="toc-section-number">15.5</span> Storage &amp; group storage access</a>
<ul>
<li><a href="slurm.html#individual-storage" id="toc-individual-storage"><span class="toc-section-number">15.5.1</span> Individual storage</a></li>
<li><a href="slurm.html#group-storage" id="toc-group-storage"><span class="toc-section-number">15.5.2</span> Group storage</a></li>
<li><a href="slurm.html#folder-permissions" id="toc-folder-permissions"><span class="toc-section-number">15.5.3</span> Folder permissions</a></li>
</ul></li>
<li><a href="slurm.html#running-big-jobs-1" id="toc-running-big-jobs-1"><span class="toc-section-number">15.6</span> Running big jobs</a></li>
</ul></li>
<li><a href="checklists.html#checklists" id="toc-checklists"><span class="toc-section-number">16</span> Checklists</a>
<ul>
<li><a href="checklists.html#pre-analysis-plan-checklist" id="toc-pre-analysis-plan-checklist"><span class="toc-section-number">16.1</span> Pre-analysis plan checklist</a></li>
<li><a href="checklists.html#code-checklist" id="toc-code-checklist"><span class="toc-section-number">16.2</span> Code checklist</a></li>
<li><a href="checklists.html#manuscript-checklist" id="toc-manuscript-checklist"><span class="toc-section-number">16.3</span> Manuscript checklist</a></li>
<li><a href="checklists.html#figure-checklist" id="toc-figure-checklist"><span class="toc-section-number">16.4</span> Figure checklist</a></li>
</ul></li>
<li><a href="resources.html#resources" id="toc-resources"><span class="toc-section-number">17</span> Resources</a>
<ul>
<li><a href="resources.html#resources-for-r" id="toc-resources-for-r"><span class="toc-section-number">17.1</span> Resources for R</a></li>
<li><a href="resources.html#resources-for-git-github" id="toc-resources-for-git-github"><span class="toc-section-number">17.2</span> Resources for Git &amp; Github</a></li>
<li><a href="resources.html#scientific-figures" id="toc-scientific-figures"><span class="toc-section-number">17.3</span> Scientific figures</a></li>
<li><a href="resources.html#writing" id="toc-writing"><span class="toc-section-number">17.4</span> Writing</a></li>
<li><a href="resources.html#presentations" id="toc-presentations"><span class="toc-section-number">17.5</span> Presentations</a></li>
<li><a href="resources.html#professional-advice" id="toc-professional-advice"><span class="toc-section-number">17.6</span> Professional advice</a></li>
<li><a href="resources.html#funding" id="toc-funding"><span class="toc-section-number">17.7</span> Funding</a></li>
<li><a href="resources.html#ethics-and-global-health-research" id="toc-ethics-and-global-health-research"><span class="toc-section-number">17.8</span> Ethics and global health research</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/jadebc/lab-manual" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Benjamin-Chung Lab Manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="unix" class="section level1 hasAnchor" number="11">
<h1><span class="header-section-number">Chapter 11</span> Unix commands<a href="unix.html#unix" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>by Stephanie Djajadi, Kunal Mishra, Anna Nguyen, and Jade Benjamin-Chung</p>
<p>We typically use Unix commands in Terminal (for Mac users) or Git Bash (for Windows users) to</p>
<ol style="list-style-type: decimal">
<li>Run a series of scripts in parallel or in a specific order to reproduce our work</li>
<li>To check on the progress of a batch of jobs</li>
<li>To use git and push to github</li>
</ol>
<div id="basics-1" class="section level2 hasAnchor" number="11.1">
<h2><span class="header-section-number">11.1</span> Basics<a href="unix.html#basics-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>On the computer, there is a desktop with two folders, <code>folder1</code> and <code>folder2</code>, and a file called <code>file1.</code> Inside <code>folder1</code>, we have a file called <code>file2.</code> Mac users can run these commands on their terminal; it is recommended that Windows users use Git Bash, not Windows PowerShell.</p>
<div class="float">
<img src="assets/images/ex-desktop.jpg" alt="Here is our example desktop." />
<div class="figcaption">Here is our example desktop.</div>
</div>
</div>
<div id="syntax-for-both-macwindows" class="section level2 hasAnchor" number="11.2">
<h2><span class="header-section-number">11.2</span> Syntax for both Mac/Windows<a href="unix.html#syntax-for-both-macwindows" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>When typing in directories or file names, quotes are necessary if the name includes spaces.</p>
<table>
<colgroup>
<col width="43%" />
<col width="56%" />
</colgroup>
<thead>
<tr class="header">
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>cd desktop/folder1</code></td>
<td>Change directory to <code>folder1</code></td>
</tr>
<tr class="even">
<td><code>pwd</code></td>
<td>Print working directory</td>
</tr>
<tr class="odd">
<td><code>ls</code></td>
<td>List files in the directory</td>
</tr>
<tr class="even">
<td><code>cp "file2" "newfile2"</code></td>
<td>Copy file (remember to include file extensions when typing in file names like <code>.pdf</code> or <code>.R</code>)</td>
</tr>
<tr class="odd">
<td><code>mv “newfile2” “file3”</code></td>
<td>Rename <code>newfile2</code> to <code>file3</code></td>
</tr>
<tr class="even">
<td><code>cd ..</code></td>
<td>Go to parent of the working directory (in this case, <code>desktop</code>)</td>
</tr>
<tr class="odd">
<td><code>mv “file1” folder2</code></td>
<td>Move <code>file1</code> to <code>folder2</code></td>
</tr>
<tr class="even">
<td><code>mkdir folder3</code></td>
<td>Make a new folder in <code>folder2</code></td>
</tr>
<tr class="odd">
<td><code>rm &lt;filename&gt;</code></td>
<td>Remove files</td>
</tr>
<tr class="even">
<td><code>rm -rf folder3</code></td>
<td>Remove directories (<code>-r</code> will attempt to remove the directory recursively, <code>-rf</code> will force removal of the directory)</td>
</tr>
<tr class="odd">
<td><code>clear</code></td>
<td>Clear terminal screen of all previous commands</td>
</tr>
</tbody>
</table>
<div class="float">
<img src="assets/images/ex-terminal.PNG" alt="Here is an example of what your terminal might look like after executing the commands in the order listed above." />
<div class="figcaption">Here is an example of what your terminal might look like after executing the commands in the order listed above.</div>
</div>
</div>
<div id="running-bash-scripts" class="section level2 hasAnchor" number="11.3">
<h2><span class="header-section-number">11.3</span> Running Bash Scripts<a href="unix.html#running-bash-scripts" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<table>
<colgroup>
<col width="25%" />
<col width="37%" />
<col width="37%" />
</colgroup>
<thead>
<tr class="header">
<th>Windows</th>
<th>Mac / Linux</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>chmod +750 &lt;filename.sh&gt;</code></td>
<td><code>chmod +x &lt;filename.sh&gt;</code></td>
<td>Change access permissions for a file (only needs to be done once)</td>
</tr>
<tr class="even">
<td><code>./&lt;filename.sh&gt;</code></td>
<td><code>./&lt;filename.sh&gt;</code></td>
<td>Run file (<code>./</code> to run any executable file)</td>
</tr>
<tr class="odd">
<td><code>bash bash_script_name.sh &amp;</code></td>
<td><code>bash bash_script_name.sh &amp;</code></td>
<td>Run shell script in the background</td>
</tr>
</tbody>
</table>
</div>
<div id="running-rscripts-in-windows" class="section level2 hasAnchor" number="11.4">
<h2><span class="header-section-number">11.4</span> Running Rscripts in Windows<a href="unix.html#running-rscripts-in-windows" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Note: This code seems to work only with Windows Command Prompt, not with Git Bash.</strong></p>
<p>When R is installed, it comes with a utility called Rscript. This allows you to run R commands from the command line. If Rscript is in your <code>PATH,</code> then typing Rscript into the command line, and pressing enter, will not error. Otherwise, to use Rscript, you will either need to add it to your PATH (as an environment variable), or append the full directory of the location of Rscript on your machine. To find the full directory, search for where R is installed your computer. For instance, it may be something like below (this will vary depending on what version of R you have installed):</p>
<p><code>C:\Program Files\R\R-3.6.0\bin</code></p>
<p>For appending the <code>PATH</code> variable, please view <a href="https://www.howtogeek.com/118594/how-to-edit-your-system-path-for-easy-command-line-access/">this link</a>. I strongly recommend completing this option.</p>
<p>If you add the PATH as an environment variable, then you can run this line of code to test:
<code>Rscript -e “cat(‘this is a test’)"</code>, where the <code>-e</code> flag refers to the expression that will be executed.</p>
<p>If you do not add the PATH as an environment variable, then you can run this line of code to replicate the results from above:
<code>“C:\Program Files\R\R-3.6.0\bin” -e “cat(‘this is a test’)”</code></p>
<p>To run an R script from the command line, we can say:
<code>Rscript -e “source(‘C:/path/to/script/some_code.R’)”</code></p>
<div id="common-mistakes" class="section level3 hasAnchor" number="11.4.1">
<h3><span class="header-section-number">11.4.1</span> Common Mistakes<a href="unix.html#common-mistakes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Remember to include all of the quotation marks around file paths that have a spaces.</li>
<li>If you attempt to run an R script but run into <code>Error: '\U' used without hex digits in character string starting "'C:\U"</code>, try replacing all <code>\</code> with <code>\\</code> or <code>/</code>.</li>
</ul>
</div>
</div>
<div id="checking-tasks-and-killing-jobs" class="section level2 hasAnchor" number="11.5">
<h2><span class="header-section-number">11.5</span> Checking tasks and killing jobs<a href="unix.html#checking-tasks-and-killing-jobs" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<table>
<colgroup>
<col width="25%" />
<col width="37%" />
<col width="37%" />
</colgroup>
<thead>
<tr class="header">
<th>Windows</th>
<th>Mac / Linux</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>tasklist</code></td>
<td><code>ps -v</code></td>
<td>List all processes on the command line</td>
</tr>
<tr class="even">
<td></td>
<td><code>top -o [cpu/rsize]</code></td>
<td>List all running processes, sorted by CPU or memory usage</td>
</tr>
<tr class="odd">
<td><code>taskkill /F /PID pid_number</code></td>
<td><code>kill &lt;PID_number&gt;</code></td>
<td>Kill a process by its process ID</td>
</tr>
<tr class="even">
<td><code>taskkill /IM "process name" /F</code></td>
<td></td>
<td>Kill a process by its name</td>
</tr>
<tr class="odd">
<td><code>start /b program.exe</code></td>
<td></td>
<td>Runs jobs in the background (exclude <code>/b</code> if you want the program to run in a new console)</td>
</tr>
<tr class="even">
<td></td>
<td><code>nohup</code></td>
<td>Prevents jobs from stopping</td>
</tr>
<tr class="odd">
<td></td>
<td><code>disown</code></td>
<td>Keeps jobs running in the background even if you close R</td>
</tr>
<tr class="even">
<td><code>taskkill /?</code></td>
<td></td>
<td>Help, lists out other commands</td>
</tr>
</tbody>
</table>
<p>To kill a task in Windows, you can also go to Task Manager &gt; More details &gt; Select your desired app &gt; Click on End Task.</p>
</div>
<div id="running-big-jobs" class="section level2 hasAnchor" number="11.6">
<h2><span class="header-section-number">11.6</span> Running big jobs<a href="unix.html#running-big-jobs" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For big data workflows, the concept of “backgrounding” a bash script allows you to start a “job” (i.e. run the script) and leave it overnight to run. At the top level, a bash script (<code>0-run-project.sh</code>) that simply calls the directory-level bash scripts (i.e. <code>0-prep-data.sh</code>, <code>0-run-analysis.sh</code>, <code>0-run-figures.sh</code>, etc.) is a powerful tool to rerun every script in your project. See the included example bash scripts for more details.</p>
<ul>
<li><strong>Running Bash Scripts in Background</strong>: Running a long bash script is not trivial. Normally you would run a bash script by opening a terminal and typing something like <code>./run-project.sh</code>. But what if you leave your computer, log out of your server, or close the terminal? Normally, the bash script will exit and fail to complete. To run it in background, type <code>./run-project.sh &amp;; disown</code>. You can see the job running (and CPU utilization) with the command <code>top</code> or <code>ps -v</code> and check your memory with <code>free -h</code>.</li>
</ul>
<p>Alternatively, to keep code running in the background even when an SSH connection is broken, you can use <code>tmux</code>. In terminal or gitbash follow the steps below. This <a href="https://medium.com/@jeongwhanchoi/install-tmux-on-osx-and-basics-commands-for-beginners-be22520fd95e">site</a> has useful tips on using <code>tmux</code>.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="unix.html#cb29-1" tabindex="-1"></a><span class="co"># create a new tmux session called session_name</span></span>
<span id="cb29-2"><a href="unix.html#cb29-2" tabindex="-1"></a><span class="ex">tmux</span> new <span class="at">-ssession_name</span></span>
<span id="cb29-3"><a href="unix.html#cb29-3" tabindex="-1"></a></span>
<span id="cb29-4"><a href="unix.html#cb29-4" tabindex="-1"></a><span class="co"># run your job of interest</span></span>
<span id="cb29-5"><a href="unix.html#cb29-5" tabindex="-1"></a><span class="ex">R</span> CMD BATCH myjob.R <span class="kw">&amp;</span> </span>
<span id="cb29-6"><a href="unix.html#cb29-6" tabindex="-1"></a>  </span>
<span id="cb29-7"><a href="unix.html#cb29-7" tabindex="-1"></a><span class="co"># check that it is running</span></span>
<span id="cb29-8"><a href="unix.html#cb29-8" tabindex="-1"></a><span class="fu">ps</span> <span class="at">-v</span></span>
<span id="cb29-9"><a href="unix.html#cb29-9" tabindex="-1"></a></span>
<span id="cb29-10"><a href="unix.html#cb29-10" tabindex="-1"></a><span class="co"># to exit the tmux session (Mac)</span></span>
<span id="cb29-11"><a href="unix.html#cb29-11" tabindex="-1"></a><span class="ex">ctrl</span> + b </span>
<span id="cb29-12"><a href="unix.html#cb29-12" tabindex="-1"></a><span class="ex">d</span></span>
<span id="cb29-13"><a href="unix.html#cb29-13" tabindex="-1"></a></span>
<span id="cb29-14"><a href="unix.html#cb29-14" tabindex="-1"></a><span class="co"># to reopen the tmux session to kill the job or </span></span>
<span id="cb29-15"><a href="unix.html#cb29-15" tabindex="-1"></a><span class="co"># start another job</span></span>
<span id="cb29-16"><a href="unix.html#cb29-16" tabindex="-1"></a><span class="ex">tmux</span> attach <span class="at">-tsession_name</span> </span></code></pre></div>
<ul>
<li><p><strong>Deleting Previously Computed Results</strong>: One helpful lesson we’ve learned is that your bash scripts should remove previous results (computed and saved by scripts run at a previous time) so that you never mix results from one run with a previous run. This can happen when an R script errors out before saving its result, and can be difficult to catch because your previously saved result exists (leading you to believe everything ran correctly).</p></li>
<li><p><strong>Ensuring Things Ran Correctly</strong>: You should check the <code>.Rout</code> files generated by the R scripts run by your bash scripts for errors once things are run. A utility file is include in this repository, called <code>runFileSaveLogs</code>, and is used by the example bash scripts to… run files and save the generated logs. It is an awesome utility and one I definitely recommend using. Before using <code>runFileSaveLogs</code>, it is necessary to put the file in the home working directory. For help and documentation, you can use the command <code>./runFileSaveLogs -h</code>. See example code and example usage for <code>runFileSaveLogs</code> below.</p></li>
</ul>
<div id="example-code-for-runfilesavelogs" class="section level3 hasAnchor" number="11.6.1">
<h3><span class="header-section-number">11.6.1</span> Example code for <code>runfileSaveLogs</code><a href="unix.html#example-code-for-runfilesavelogs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb30"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="unix.html#cb30-1" tabindex="-1"></a><span class="co">#!/usr/bin/env python3</span></span>
<span id="cb30-2"><a href="unix.html#cb30-2" tabindex="-1"></a><span class="co"># Type &quot;./runFileSaveLogs -h&quot; for help</span></span>
<span id="cb30-3"><a href="unix.html#cb30-3" tabindex="-1"></a></span>
<span id="cb30-4"><a href="unix.html#cb30-4" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb30-5"><a href="unix.html#cb30-5" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb30-6"><a href="unix.html#cb30-6" tabindex="-1"></a><span class="im">import</span> argparse</span>
<span id="cb30-7"><a href="unix.html#cb30-7" tabindex="-1"></a><span class="im">import</span> getpass</span>
<span id="cb30-8"><a href="unix.html#cb30-8" tabindex="-1"></a><span class="im">import</span> datetime</span>
<span id="cb30-9"><a href="unix.html#cb30-9" tabindex="-1"></a><span class="im">import</span> shutil</span>
<span id="cb30-10"><a href="unix.html#cb30-10" tabindex="-1"></a><span class="im">import</span> glob</span>
<span id="cb30-11"><a href="unix.html#cb30-11" tabindex="-1"></a><span class="im">import</span> pathlib</span>
<span id="cb30-12"><a href="unix.html#cb30-12" tabindex="-1"></a></span>
<span id="cb30-13"><a href="unix.html#cb30-13" tabindex="-1"></a><span class="co"># Setting working directory to this script&#39;s current directory</span></span>
<span id="cb30-14"><a href="unix.html#cb30-14" tabindex="-1"></a>os.chdir(os.path.dirname(os.path.abspath(<span class="va">__file__</span>)))</span>
<span id="cb30-15"><a href="unix.html#cb30-15" tabindex="-1"></a></span>
<span id="cb30-16"><a href="unix.html#cb30-16" tabindex="-1"></a><span class="co"># Setting up argument parser</span></span>
<span id="cb30-17"><a href="unix.html#cb30-17" tabindex="-1"></a>parser <span class="op">=</span> argparse.ArgumentParser(description<span class="op">=</span><span class="st">&#39;Runs the argument R script(s) - in parallel if specified - and moves the subsequent generated .Rout log files to a timestamped directory.&#39;</span>)</span>
<span id="cb30-18"><a href="unix.html#cb30-18" tabindex="-1"></a></span>
<span id="cb30-19"><a href="unix.html#cb30-19" tabindex="-1"></a><span class="co"># Function ensuring that the file is valid</span></span>
<span id="cb30-20"><a href="unix.html#cb30-20" tabindex="-1"></a><span class="kw">def</span> is_valid_file(parser, arg):</span>
<span id="cb30-21"><a href="unix.html#cb30-21" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(arg):</span>
<span id="cb30-22"><a href="unix.html#cb30-22" tabindex="-1"></a>        parser.error(<span class="st">&quot;The file </span><span class="sc">%s</span><span class="st"> does not exist!&quot;</span> <span class="op">%</span> arg)</span>
<span id="cb30-23"><a href="unix.html#cb30-23" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb30-24"><a href="unix.html#cb30-24" tabindex="-1"></a>        <span class="cf">return</span> arg</span>
<span id="cb30-25"><a href="unix.html#cb30-25" tabindex="-1"></a></span>
<span id="cb30-26"><a href="unix.html#cb30-26" tabindex="-1"></a><span class="co"># Function ensuring that the directory is valid</span></span>
<span id="cb30-27"><a href="unix.html#cb30-27" tabindex="-1"></a><span class="kw">def</span> is_valid_directory(parser, arg):</span>
<span id="cb30-28"><a href="unix.html#cb30-28" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.isdir(arg):</span>
<span id="cb30-29"><a href="unix.html#cb30-29" tabindex="-1"></a>        parser.error(<span class="st">&quot;The specified path (</span><span class="sc">%s</span><span class="st">) is not a directory!&quot;</span> <span class="op">%</span> arg)</span>
<span id="cb30-30"><a href="unix.html#cb30-30" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb30-31"><a href="unix.html#cb30-31" tabindex="-1"></a>        <span class="cf">return</span> arg</span>
<span id="cb30-32"><a href="unix.html#cb30-32" tabindex="-1"></a></span>
<span id="cb30-33"><a href="unix.html#cb30-33" tabindex="-1"></a><span class="co"># Additional arguments that can be added when running runFileSaveLogs</span></span>
<span id="cb30-34"><a href="unix.html#cb30-34" tabindex="-1"></a>parser.add_argument(<span class="st">&#39;-p&#39;</span>, <span class="st">&#39;--parallel&#39;</span>, action<span class="op">=</span><span class="st">&#39;store_true&#39;</span>, <span class="bu">help</span><span class="op">=</span><span class="st">&quot;Runs the argument R scripts in parallel if specified&quot;</span>)</span>
<span id="cb30-35"><a href="unix.html#cb30-35" tabindex="-1"></a>parser.add_argument(<span class="st">&quot;-i&quot;</span>, <span class="st">&quot;--identifier&quot;</span>, <span class="bu">help</span><span class="op">=</span><span class="st">&quot;Adds an identifier to the directory name where this is saved&quot;</span>)</span>
<span id="cb30-36"><a href="unix.html#cb30-36" tabindex="-1"></a>parser.add_argument(<span class="st">&#39;filenames&#39;</span>, nargs<span class="op">=</span><span class="st">&#39;+&#39;</span>, <span class="bu">type</span><span class="op">=</span><span class="kw">lambda</span> x: is_valid_file(parser, x))</span>
<span id="cb30-37"><a href="unix.html#cb30-37" tabindex="-1"></a></span>
<span id="cb30-38"><a href="unix.html#cb30-38" tabindex="-1"></a>args <span class="op">=</span> parser.parse_args()</span>
<span id="cb30-39"><a href="unix.html#cb30-39" tabindex="-1"></a>args_dict <span class="op">=</span> <span class="bu">vars</span>(args)</span>
<span id="cb30-40"><a href="unix.html#cb30-40" tabindex="-1"></a></span>
<span id="cb30-41"><a href="unix.html#cb30-41" tabindex="-1"></a><span class="bu">print</span>(args_dict)</span>
<span id="cb30-42"><a href="unix.html#cb30-42" tabindex="-1"></a></span>
<span id="cb30-43"><a href="unix.html#cb30-43" tabindex="-1"></a><span class="co"># Run given R Scripts</span></span>
<span id="cb30-44"><a href="unix.html#cb30-44" tabindex="-1"></a><span class="cf">for</span> filename <span class="kw">in</span> args_dict[<span class="st">&quot;filenames&quot;</span>]:</span>
<span id="cb30-45"><a href="unix.html#cb30-45" tabindex="-1"></a>  system_call <span class="op">=</span> <span class="st">&quot;R CMD BATCH&quot;</span> <span class="op">+</span> <span class="st">&quot; &quot;</span> <span class="op">+</span> filename</span>
<span id="cb30-46"><a href="unix.html#cb30-46" tabindex="-1"></a>  <span class="cf">if</span> args_dict[<span class="st">&quot;parallel&quot;</span>]: </span>
<span id="cb30-47"><a href="unix.html#cb30-47" tabindex="-1"></a>    system_call <span class="op">=</span> <span class="st">&quot;nohup&quot;</span> <span class="op">+</span> <span class="st">&quot; &quot;</span> <span class="op">+</span> system_call <span class="op">+</span> <span class="st">&quot; &amp;&quot;</span></span>
<span id="cb30-48"><a href="unix.html#cb30-48" tabindex="-1"></a></span>
<span id="cb30-49"><a href="unix.html#cb30-49" tabindex="-1"></a>  os.system(system_call)</span>
<span id="cb30-50"><a href="unix.html#cb30-50" tabindex="-1"></a></span>
<span id="cb30-51"><a href="unix.html#cb30-51" tabindex="-1"></a><span class="co"># Create the directory (and any parents) of the log files</span></span>
<span id="cb30-52"><a href="unix.html#cb30-52" tabindex="-1"></a>currentUser <span class="op">=</span> getpass.getuser()</span>
<span id="cb30-53"><a href="unix.html#cb30-53" tabindex="-1"></a>currentTime <span class="op">=</span> datetime.datetime.now().strftime(<span class="st">&quot;%Y-%m-</span><span class="sc">%d</span><span class="st"> %H:%M:%S&quot;</span>)</span>
<span id="cb30-54"><a href="unix.html#cb30-54" tabindex="-1"></a>logDirPrefix <span class="op">=</span> <span class="st">&quot;/home/kaiserData/logs/&quot;</span> <span class="co"># Change to the directory where the logs should be saved</span></span>
<span id="cb30-55"><a href="unix.html#cb30-55" tabindex="-1"></a>logDir <span class="op">=</span> logDirPrefix <span class="op">+</span> currentTime <span class="op">+</span> <span class="st">&quot;-&quot;</span> <span class="op">+</span> currentUser </span>
<span id="cb30-56"><a href="unix.html#cb30-56" tabindex="-1"></a></span>
<span id="cb30-57"><a href="unix.html#cb30-57" tabindex="-1"></a><span class="co"># If specified, adds the identifier to the filename of the log</span></span>
<span id="cb30-58"><a href="unix.html#cb30-58" tabindex="-1"></a><span class="cf">if</span> args.identifier <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb30-59"><a href="unix.html#cb30-59" tabindex="-1"></a>  logDir <span class="op">+=</span> <span class="st">&quot;-&quot;</span> <span class="op">+</span> args.identifier</span>
<span id="cb30-60"><a href="unix.html#cb30-60" tabindex="-1"></a></span>
<span id="cb30-61"><a href="unix.html#cb30-61" tabindex="-1"></a>logDir <span class="op">+=</span> <span class="st">&quot;/&quot;</span></span>
<span id="cb30-62"><a href="unix.html#cb30-62" tabindex="-1"></a></span>
<span id="cb30-63"><a href="unix.html#cb30-63" tabindex="-1"></a>pathlib.Path(logDir).mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-64"><a href="unix.html#cb30-64" tabindex="-1"></a></span>
<span id="cb30-65"><a href="unix.html#cb30-65" tabindex="-1"></a><span class="co"># Find and move all logs to this new directory</span></span>
<span id="cb30-66"><a href="unix.html#cb30-66" tabindex="-1"></a>currentLogPaths <span class="op">=</span> glob.glob(<span class="st">&#39;./*.Rout&#39;</span>)</span>
<span id="cb30-67"><a href="unix.html#cb30-67" tabindex="-1"></a></span>
<span id="cb30-68"><a href="unix.html#cb30-68" tabindex="-1"></a><span class="cf">for</span> currentLogPath <span class="kw">in</span> currentLogPaths:</span>
<span id="cb30-69"><a href="unix.html#cb30-69" tabindex="-1"></a>  filename <span class="op">=</span> currentLogPath.split(<span class="st">&quot;/&quot;</span>)[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb30-70"><a href="unix.html#cb30-70" tabindex="-1"></a>  shutil.move(currentLogPath, logDir <span class="op">+</span> filename)</span></code></pre></div>
</div>
<div id="example-usage-for-runfilesavelogs" class="section level3 hasAnchor" number="11.6.2">
<h3><span class="header-section-number">11.6.2</span> Example usage for <code>runfileSaveLogs</code><a href="unix.html#example-usage-for-runfilesavelogs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This example bash script runs files and generates logs for five scripts in the <code>kaiserflu/3-figures</code> folder. Note that the <code>-i</code> flag is used as an identifier to add <code>figures</code> to the filename of each log.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb31-1"><a href="unix.html#cb31-1" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb31-2"><a href="unix.html#cb31-2" tabindex="-1"></a></span>
<span id="cb31-3"><a href="unix.html#cb31-3" tabindex="-1"></a><span class="co"># Copy utility run script into this folder for concision in call</span></span>
<span id="cb31-4"><a href="unix.html#cb31-4" tabindex="-1"></a><span class="fu">cp</span> ~/kaiserflu/runFileSaveLogs ~/kaiserflu/3-figures/</span>
<span id="cb31-5"><a href="unix.html#cb31-5" tabindex="-1"></a></span>
<span id="cb31-6"><a href="unix.html#cb31-6" tabindex="-1"></a><span class="co"># Run folder scripts and produce output</span></span>
<span id="cb31-7"><a href="unix.html#cb31-7" tabindex="-1"></a><span class="bu">cd</span> ~/kaiserflu/3-figures/</span>
<span id="cb31-8"><a href="unix.html#cb31-8" tabindex="-1"></a><span class="ex">./runFileSaveLogs</span> <span class="at">-i</span> <span class="st">&quot;figures&quot;</span> <span class="dt">\</span></span>
<span id="cb31-9"><a href="unix.html#cb31-9" tabindex="-1"></a>fig-mean-season-age.R <span class="dt">\</span></span>
<span id="cb31-10"><a href="unix.html#cb31-10" tabindex="-1"></a>fig-monthly-rate.R <span class="dt">\</span></span>
<span id="cb31-11"><a href="unix.html#cb31-11" tabindex="-1"></a>fig-point-estimates-combined.R <span class="dt">\</span></span>
<span id="cb31-12"><a href="unix.html#cb31-12" tabindex="-1"></a>fig-point-estimates.R <span class="dt">\</span></span>
<span id="cb31-13"><a href="unix.html#cb31-13" tabindex="-1"></a>fig-weekly-rate.R</span>
<span id="cb31-14"><a href="unix.html#cb31-14" tabindex="-1"></a></span>
<span id="cb31-15"><a href="unix.html#cb31-15" tabindex="-1"></a><span class="co"># Remove copied utility run script</span></span>
<span id="cb31-16"><a href="unix.html#cb31-16" tabindex="-1"></a><span class="fu">rm</span> runFileSaveLogs</span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="github.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="reproducible-environments.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jadebc/lab-manual/edit/master/10-unix.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["lab-manual.pdf", "lab-manual.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
