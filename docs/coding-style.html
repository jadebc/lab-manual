<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Coding style | Benjamin-Chung Lab Manual</title>
  <meta name="description" content="Lab practices and data science best practices" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Coding style | Benjamin-Chung Lab Manual" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Lab practices and data science best practices" />
  <meta name="github-repo" content="jadebc/lab-manual" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Coding style | Benjamin-Chung Lab Manual" />
  
  <meta name="twitter:description" content="Lab practices and data science best practices" />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="coding-practices.html"/>
<link rel="next" href="working-with-big-data.html"/>
<script src="libs/header-attrs-2.21/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Lab manual</a></li>

<li class="divider"></li>
<li><a href="index.html#welcome-to-the-benjamin-chung-lab" id="toc-welcome-to-the-benjamin-chung-lab"><span class="toc-section-number">1</span> Welcome to the Benjamin-Chung Lab!</a>
<ul>
<li><a href="index.html#about-the-lab" id="toc-about-the-lab"><span class="toc-section-number">1.1</span> About the lab</a></li>
<li><a href="index.html#about-this-lab-manual" id="toc-about-this-lab-manual"><span class="toc-section-number">1.2</span> About this lab manual</a></li>
</ul></li>
<li><a href="culture-and-conduct.html#culture-and-conduct" id="toc-culture-and-conduct"><span class="toc-section-number">2</span> Culture and conduct</a>
<ul>
<li><a href="culture-and-conduct.html#lab-culture" id="toc-lab-culture"><span class="toc-section-number">2.1</span> Lab culture</a></li>
<li><a href="culture-and-conduct.html#diversity-equity-and-inclusion" id="toc-diversity-equity-and-inclusion"><span class="toc-section-number">2.2</span> Diversity, equity, and inclusion</a></li>
<li><a href="culture-and-conduct.html#protecting-human-subjects" id="toc-protecting-human-subjects"><span class="toc-section-number">2.3</span> Protecting human subjects</a></li>
<li><a href="culture-and-conduct.html#authorship" id="toc-authorship"><span class="toc-section-number">2.4</span> Authorship</a></li>
</ul></li>
<li><a href="communication-and-coordination.html#communication-and-coordination" id="toc-communication-and-coordination"><span class="toc-section-number">3</span> Communication and coordination</a>
<ul>
<li><a href="communication-and-coordination.html#slack" id="toc-slack"><span class="toc-section-number">3.1</span> Slack</a></li>
<li><a href="communication-and-coordination.html#email" id="toc-email"><span class="toc-section-number">3.2</span> Email</a></li>
<li><a href="communication-and-coordination.html#trello" id="toc-trello"><span class="toc-section-number">3.3</span> Trello</a></li>
<li><a href="communication-and-coordination.html#google-drives" id="toc-google-drives"><span class="toc-section-number">3.4</span> Google Drives</a></li>
<li><a href="communication-and-coordination.html#meetings" id="toc-meetings"><span class="toc-section-number">3.5</span> Meetings</a></li>
</ul></li>
<li><a href="reproducibility.html#reproducibility" id="toc-reproducibility"><span class="toc-section-number">4</span> Reproducibility</a>
<ul>
<li><a href="reproducibility.html#what-is-the-reproducibility-crisis" id="toc-what-is-the-reproducibility-crisis"><span class="toc-section-number">4.1</span> What is the reproducibility crisis?</a></li>
<li><a href="reproducibility.html#study-design" id="toc-study-design"><span class="toc-section-number">4.2</span> Study design</a></li>
<li><a href="reproducibility.html#register-study-protocols" id="toc-register-study-protocols"><span class="toc-section-number">4.3</span> Register study protocols</a></li>
<li><a href="reproducibility.html#write-and-register-pre-analysis-plans" id="toc-write-and-register-pre-analysis-plans"><span class="toc-section-number">4.4</span> Write and register pre-analysis plans</a></li>
<li><a href="reproducibility.html#create-reproducible-workflows" id="toc-create-reproducible-workflows"><span class="toc-section-number">4.5</span> Create reproducible workflows</a></li>
<li><a href="reproducibility.html#process-and-analyze-data-with-internal-replication-and-masking" id="toc-process-and-analyze-data-with-internal-replication-and-masking"><span class="toc-section-number">4.6</span> Process and analyze data with internal replication and masking</a></li>
<li><a href="reproducibility.html#use-reporting-checklists-with-manuscripts" id="toc-use-reporting-checklists-with-manuscripts"><span class="toc-section-number">4.7</span> Use reporting checklists with manuscripts</a></li>
<li><a href="reproducibility.html#publish-preprints" id="toc-publish-preprints"><span class="toc-section-number">4.8</span> Publish preprints</a></li>
<li><a href="reproducibility.html#publish-data-when-possible-and-replication-scripts" id="toc-publish-data-when-possible-and-replication-scripts"><span class="toc-section-number">4.9</span> Publish data (when possible) and replication scripts</a></li>
</ul></li>
<li><a href="code-repositories.html#code-repositories" id="toc-code-repositories"><span class="toc-section-number">5</span> Code repositories</a>
<ul>
<li><a href="code-repositories.html#project-structure" id="toc-project-structure"><span class="toc-section-number">5.1</span> Project Structure</a></li>
<li><a href="code-repositories.html#rproj-files" id="toc-rproj-files"><span class="toc-section-number">5.2</span> <code>.Rproj</code> files</a></li>
<li><a href="code-repositories.html#configuration-config-file" id="toc-configuration-config-file"><span class="toc-section-number">5.3</span> Configuration (‘config’) File</a></li>
<li><a href="code-repositories.html#order-files-and-directories" id="toc-order-files-and-directories"><span class="toc-section-number">5.4</span> Order Files and Directories</a></li>
<li><a href="code-repositories.html#using-bash-scripts-to-ensure-reproducibility" id="toc-using-bash-scripts-to-ensure-reproducibility"><span class="toc-section-number">5.5</span> Using Bash scripts to ensure reproducibility</a></li>
</ul></li>
<li><a href="coding-practices.html#coding-practices" id="toc-coding-practices"><span class="toc-section-number">6</span> Coding practices</a>
<ul>
<li><a href="coding-practices.html#organizing-scripts" id="toc-organizing-scripts"><span class="toc-section-number">6.1</span> Organizing scripts</a></li>
<li><a href="coding-practices.html#documenting-your-code" id="toc-documenting-your-code"><span class="toc-section-number">6.2</span> Documenting your code</a>
<ul>
<li><a href="coding-practices.html#file-headers" id="toc-file-headers"><span class="toc-section-number">6.2.1</span> File headers</a></li>
<li><a href="coding-practices.html#sections-and-subsections" id="toc-sections-and-subsections"><span class="toc-section-number">6.2.2</span> Sections and subsections</a></li>
<li><a href="coding-practices.html#code-folding" id="toc-code-folding"><span class="toc-section-number">6.2.3</span> Code folding</a></li>
<li><a href="coding-practices.html#comments-in-the-body-of-your-script" id="toc-comments-in-the-body-of-your-script"><span class="toc-section-number">6.2.4</span> Comments in the body of your script</a></li>
<li><a href="coding-practices.html#function-documentation" id="toc-function-documentation"><span class="toc-section-number">6.2.5</span> Function documentation</a></li>
</ul></li>
<li><a href="coding-practices.html#object-naming" id="toc-object-naming"><span class="toc-section-number">6.3</span> Object naming</a></li>
<li><a href="coding-practices.html#function-calls" id="toc-function-calls"><span class="toc-section-number">6.4</span> Function calls</a></li>
<li><a href="coding-practices.html#the-here-package" id="toc-the-here-package"><span class="toc-section-number">6.5</span> The here package</a></li>
<li><a href="coding-practices.html#readingsaving-data" id="toc-readingsaving-data"><span class="toc-section-number">6.6</span> Reading/Saving Data</a>
<ul>
<li><a href="coding-practices.html#rds-vs-.rdata-files" id="toc-rds-vs-.rdata-files"><span class="toc-section-number">6.6.1</span> <code>.RDS</code> vs <code>.RData</code> Files</a></li>
<li><a href="coding-practices.html#csvs" id="toc-csvs"><span class="toc-section-number">6.6.2</span> CSVs</a></li>
</ul></li>
<li><a href="coding-practices.html#integrating-box-and-dropbox" id="toc-integrating-box-and-dropbox"><span class="toc-section-number">6.7</span> Integrating Box and Dropbox</a>
<ul>
<li><a href="coding-practices.html#box" id="toc-box"><span class="toc-section-number">6.7.1</span> Box</a></li>
<li><a href="coding-practices.html#dropbox" id="toc-dropbox"><span class="toc-section-number">6.7.2</span> Dropbox</a></li>
</ul></li>
<li><a href="coding-practices.html#tidyverse" id="toc-tidyverse"><span class="toc-section-number">6.8</span> Tidyverse</a></li>
<li><a href="coding-practices.html#coding-with-r-and-python" id="toc-coding-with-r-and-python"><span class="toc-section-number">6.9</span> Coding with R and Python</a></li>
<li><a href="coding-practices.html#repeating-analyses-with-different-variations" id="toc-repeating-analyses-with-different-variations"><span class="toc-section-number">6.10</span> Repeating analyses with different variations</a>
<ul>
<li><a href="coding-practices.html#lapply-and-sapply" id="toc-lapply-and-sapply"><span class="toc-section-number">6.10.1</span> <code>lapply()</code> and <code>sapply()</code></a></li>
<li><a href="coding-practices.html#mapply-and-pmap" id="toc-mapply-and-pmap"><span class="toc-section-number">6.10.2</span> <code>mapply()</code> and <code>pmap()</code></a></li>
<li><a href="coding-practices.html#parallel-processing-with-parallel-and-future-packages" id="toc-parallel-processing-with-parallel-and-future-packages"><span class="toc-section-number">6.10.3</span> Parallel processing with <code>parallel</code> and <code>future</code> packages</a></li>
</ul></li>
<li><a href="coding-practices.html#reviewing-code" id="toc-reviewing-code"><span class="toc-section-number">6.11</span> Reviewing Code</a>
<ul>
<li><a href="coding-practices.html#creating-a-pull-request-template" id="toc-creating-a-pull-request-template"><span class="toc-section-number">6.11.1</span> Creating a Pull Request Template</a></li>
</ul></li>
</ul></li>
<li><a href="coding-style.html#coding-style" id="toc-coding-style"><span class="toc-section-number">7</span> Coding style</a>
<ul>
<li><a href="coding-style.html#comments" id="toc-comments"><span class="toc-section-number">7.1</span> Comments</a></li>
<li><a href="coding-style.html#line-breaks" id="toc-line-breaks"><span class="toc-section-number">7.2</span> Line breaks</a></li>
<li><a href="coding-style.html#automated-tools-for-style-and-project-workflow" id="toc-automated-tools-for-style-and-project-workflow"><span class="toc-section-number">7.3</span> Automated Tools for Style and Project Workflow</a>
<ul>
<li><a href="coding-style.html#styling" id="toc-styling"><span class="toc-section-number">7.3.1</span> Styling</a></li>
</ul></li>
</ul></li>
<li><a href="working-with-big-data.html#working-with-big-data" id="toc-working-with-big-data"><span class="toc-section-number">8</span> Working with Big Data</a>
<ul>
<li><a href="working-with-big-data.html#the-data.table-package" id="toc-the-data.table-package"><span class="toc-section-number">8.1</span> The data.table package</a></li>
<li><a href="working-with-big-data.html#using-downsampled-data" id="toc-using-downsampled-data"><span class="toc-section-number">8.2</span> Using downsampled data</a></li>
<li><a href="working-with-big-data.html#optimal-rstudio-set-up" id="toc-optimal-rstudio-set-up"><span class="toc-section-number">8.3</span> Optimal RStudio set up</a></li>
</ul></li>
<li><a href="data-masking.html#data-masking" id="toc-data-masking"><span class="toc-section-number">9</span> Data masking</a>
<ul>
<li><a href="data-masking.html#general-overview" id="toc-general-overview"><span class="toc-section-number">9.1</span> General Overview</a>
<ul>
<li><a href="data-masking.html#what-is-data-masking" id="toc-what-is-data-masking"><span class="toc-section-number">9.1.1</span> What is Data Masking?</a></li>
<li><a href="data-masking.html#using-tidy-evaluation-for-data-masking" id="toc-using-tidy-evaluation-for-data-masking"><span class="toc-section-number">9.1.2</span> Using tidy evaluation for data masking</a></li>
</ul></li>
<li><a href="data-masking.html#technical-overview" id="toc-technical-overview"><span class="toc-section-number">9.2</span> Technical Overview</a>
<ul>
<li><a href="data-masking.html#example" id="toc-example"><span class="toc-section-number">9.2.1</span> Example</a></li>
</ul></li>
</ul></li>
<li><a href="github.html#github" id="toc-github"><span class="toc-section-number">10</span> Github</a>
<ul>
<li><a href="github.html#basics" id="toc-basics"><span class="toc-section-number">10.1</span> Basics</a></li>
<li><a href="github.html#github-desktop" id="toc-github-desktop"><span class="toc-section-number">10.2</span> Github Desktop</a></li>
<li><a href="github.html#git-branching" id="toc-git-branching"><span class="toc-section-number">10.3</span> Git Branching</a></li>
<li><a href="github.html#example-workflow" id="toc-example-workflow"><span class="toc-section-number">10.4</span> Example Workflow</a></li>
<li><a href="github.html#commonly-used-git-commands" id="toc-commonly-used-git-commands"><span class="toc-section-number">10.5</span> Commonly Used Git Commands</a></li>
<li><a href="github.html#how-often-should-i-commit" id="toc-how-often-should-i-commit"><span class="toc-section-number">10.6</span> How often should I commit?</a></li>
<li><a href="github.html#what-should-be-pushed-to-github" id="toc-what-should-be-pushed-to-github"><span class="toc-section-number">10.7</span> What should be pushed to Github?</a></li>
</ul></li>
<li><a href="unix.html#unix" id="toc-unix"><span class="toc-section-number">11</span> Unix commands</a>
<ul>
<li><a href="unix.html#basics-1" id="toc-basics-1"><span class="toc-section-number">11.1</span> Basics</a></li>
<li><a href="unix.html#syntax-for-both-macwindows" id="toc-syntax-for-both-macwindows"><span class="toc-section-number">11.2</span> Syntax for both Mac/Windows</a></li>
<li><a href="unix.html#running-bash-scripts" id="toc-running-bash-scripts"><span class="toc-section-number">11.3</span> Running Bash Scripts</a></li>
<li><a href="unix.html#running-rscripts-in-windows" id="toc-running-rscripts-in-windows"><span class="toc-section-number">11.4</span> Running Rscripts in Windows</a>
<ul>
<li><a href="unix.html#common-mistakes" id="toc-common-mistakes"><span class="toc-section-number">11.4.1</span> Common Mistakes</a></li>
</ul></li>
<li><a href="unix.html#checking-tasks-and-killing-jobs" id="toc-checking-tasks-and-killing-jobs"><span class="toc-section-number">11.5</span> Checking tasks and killing jobs</a></li>
<li><a href="unix.html#running-big-jobs" id="toc-running-big-jobs"><span class="toc-section-number">11.6</span> Running big jobs</a>
<ul>
<li><a href="unix.html#example-code-for-runfilesavelogs" id="toc-example-code-for-runfilesavelogs"><span class="toc-section-number">11.6.1</span> Example code for <code>runfileSaveLogs</code></a></li>
<li><a href="unix.html#example-usage-for-runfilesavelogs" id="toc-example-usage-for-runfilesavelogs"><span class="toc-section-number">11.6.2</span> Example usage for <code>runfileSaveLogs</code></a></li>
</ul></li>
</ul></li>
<li><a href="reproducible-environments.html#reproducible-environments" id="toc-reproducible-environments"><span class="toc-section-number">12</span> Reproducible Environments</a>
<ul>
<li><a href="reproducible-environments.html#package-version-control-with-renv" id="toc-package-version-control-with-renv"><span class="toc-section-number">12.1</span> Package Version Control with renv</a>
<ul>
<li><a href="reproducible-environments.html#introduction" id="toc-introduction"><span class="toc-section-number">12.1.1</span> Introduction</a></li>
<li><a href="reproducible-environments.html#implementing-renv-in-projects" id="toc-implementing-renv-in-projects"><span class="toc-section-number">12.1.2</span> Implementing renv in projects</a></li>
<li><a href="reproducible-environments.html#using-projects-with-renv" id="toc-using-projects-with-renv"><span class="toc-section-number">12.1.3</span> Using projects with renv</a></li>
</ul></li>
</ul></li>
<li><a href="code-publication.html#code-publication" id="toc-code-publication"><span class="toc-section-number">13</span> Code Publication</a>
<ul>
<li><a href="code-publication.html#checklist-overview" id="toc-checklist-overview"><span class="toc-section-number">13.1</span> Checklist overview</a></li>
<li><a href="code-publication.html#fill-out-file-headers" id="toc-fill-out-file-headers"><span class="toc-section-number">13.2</span> Fill out file headers</a></li>
<li><a href="code-publication.html#clean-up-comments" id="toc-clean-up-comments"><span class="toc-section-number">13.3</span> Clean up comments</a></li>
<li><a href="code-publication.html#document-functions" id="toc-document-functions"><span class="toc-section-number">13.4</span> Document functions</a></li>
<li><a href="code-publication.html#remove-deprecated-filepaths" id="toc-remove-deprecated-filepaths"><span class="toc-section-number">13.5</span> Remove deprecated filepaths</a></li>
<li><a href="code-publication.html#ensure-project-runs-via-bash" id="toc-ensure-project-runs-via-bash"><span class="toc-section-number">13.6</span> Ensure project runs via bash</a></li>
<li><a href="code-publication.html#complete-the-readme" id="toc-complete-the-readme"><span class="toc-section-number">13.7</span> Complete the README</a></li>
<li><a href="code-publication.html#clean-up-feature-branches" id="toc-clean-up-feature-branches"><span class="toc-section-number">13.8</span> Clean up feature branches</a></li>
<li><a href="code-publication.html#create-github-release" id="toc-create-github-release"><span class="toc-section-number">13.9</span> Create Github release</a></li>
</ul></li>
<li><a href="data-publication.html#data-publication" id="toc-data-publication"><span class="toc-section-number">14</span> Data Publication</a>
<ul>
<li><a href="data-publication.html#overview" id="toc-overview"><span class="toc-section-number">14.1</span> Overview</a></li>
<li><a href="data-publication.html#removing-phi" id="toc-removing-phi"><span class="toc-section-number">14.2</span> Removing PHI</a>
<ul>
<li><a href="data-publication.html#personal-information" id="toc-personal-information"><span class="toc-section-number">14.2.1</span> Personal information</a></li>
<li><a href="data-publication.html#dates" id="toc-dates"><span class="toc-section-number">14.2.2</span> Dates</a></li>
<li><a href="data-publication.html#geographic-information" id="toc-geographic-information"><span class="toc-section-number">14.2.3</span> Geographic information</a></li>
</ul></li>
<li><a href="data-publication.html#create-public-ids" id="toc-create-public-ids"><span class="toc-section-number">14.3</span> Create public IDs</a>
<ul>
<li><a href="data-publication.html#rationale" id="toc-rationale"><span class="toc-section-number">14.3.1</span> Rationale</a></li>
<li><a href="data-publication.html#a-single-set-of-public-ids-for-each-study" id="toc-a-single-set-of-public-ids-for-each-study"><span class="toc-section-number">14.3.2</span> A single set of public IDs for each study</a></li>
<li><a href="data-publication.html#example-scripts" id="toc-example-scripts"><span class="toc-section-number">14.3.3</span> Example scripts</a></li>
</ul></li>
<li><a href="data-publication.html#create-a-data-repository" id="toc-create-a-data-repository"><span class="toc-section-number">14.4</span> Create a data repository</a>
<ul>
<li><a href="data-publication.html#steps-for-creating-an-open-science-framework-osf-repository" id="toc-steps-for-creating-an-open-science-framework-osf-repository"><span class="toc-section-number">14.4.1</span> Steps for creating an Open Science Framework (OSF) repository:</a></li>
</ul></li>
<li><a href="data-publication.html#edit-and-test-analysis-scripts" id="toc-edit-and-test-analysis-scripts"><span class="toc-section-number">14.5</span> Edit and test analysis scripts</a></li>
<li><a href="data-publication.html#create-a-public-github-page-for-public-scripts" id="toc-create-a-public-github-page-for-public-scripts"><span class="toc-section-number">14.6</span> Create a public GitHub page for public scripts</a></li>
<li><a href="data-publication.html#go-live" id="toc-go-live"><span class="toc-section-number">14.7</span> Go live</a></li>
</ul></li>
<li><a href="slurm.html#slurm" id="toc-slurm"><span class="toc-section-number">15</span> Slurm and cluster computing</a>
<ul>
<li><a href="slurm.html#getting-started" id="toc-getting-started"><span class="toc-section-number">15.1</span> Getting started</a>
<ul>
<li><a href="slurm.html#one-time-system-set-up" id="toc-one-time-system-set-up"><span class="toc-section-number">15.1.1</span> One-Time System Set-Up</a></li>
</ul></li>
<li><a href="slurm.html#moving-files-to-sherlock" id="toc-moving-files-to-sherlock"><span class="toc-section-number">15.2</span> Moving files to Sherlock</a></li>
<li><a href="slurm.html#installing-packages-on-sherlock" id="toc-installing-packages-on-sherlock"><span class="toc-section-number">15.3</span> Installing packages on Sherlock</a></li>
<li><a href="slurm.html#testing-your-code" id="toc-testing-your-code"><span class="toc-section-number">15.4</span> Testing your code</a>
<ul>
<li><a href="slurm.html#the-command-line" id="toc-the-command-line"><span class="toc-section-number">15.4.1</span> The command line</a></li>
<li><a href="slurm.html#the-sherlock-ondemand-dashboard" id="toc-the-sherlock-ondemand-dashboard"><span class="toc-section-number">15.4.2</span> The Sherlock OnDemand Dashboard</a></li>
<li><a href="slurm.html#filepaths-configuration-on-sherlock" id="toc-filepaths-configuration-on-sherlock"><span class="toc-section-number">15.4.3</span> Filepaths &amp; configuration on Sherlock</a></li>
</ul></li>
<li><a href="slurm.html#storage-group-storage-access" id="toc-storage-group-storage-access"><span class="toc-section-number">15.5</span> Storage &amp; group storage access</a>
<ul>
<li><a href="slurm.html#individual-storage" id="toc-individual-storage"><span class="toc-section-number">15.5.1</span> Individual storage</a></li>
<li><a href="slurm.html#group-storage" id="toc-group-storage"><span class="toc-section-number">15.5.2</span> Group storage</a></li>
<li><a href="slurm.html#folder-permissions" id="toc-folder-permissions"><span class="toc-section-number">15.5.3</span> Folder permissions</a></li>
</ul></li>
<li><a href="slurm.html#running-big-jobs-1" id="toc-running-big-jobs-1"><span class="toc-section-number">15.6</span> Running big jobs</a></li>
</ul></li>
<li><a href="checklists.html#checklists" id="toc-checklists"><span class="toc-section-number">16</span> Checklists</a>
<ul>
<li><a href="checklists.html#pre-analysis-plan-checklist" id="toc-pre-analysis-plan-checklist"><span class="toc-section-number">16.1</span> Pre-analysis plan checklist</a></li>
<li><a href="checklists.html#code-checklist" id="toc-code-checklist"><span class="toc-section-number">16.2</span> Code checklist</a></li>
<li><a href="checklists.html#manuscript-checklist" id="toc-manuscript-checklist"><span class="toc-section-number">16.3</span> Manuscript checklist</a></li>
<li><a href="checklists.html#figure-checklist" id="toc-figure-checklist"><span class="toc-section-number">16.4</span> Figure checklist</a></li>
</ul></li>
<li><a href="resources.html#resources" id="toc-resources"><span class="toc-section-number">17</span> Resources</a>
<ul>
<li><a href="resources.html#resources-for-r" id="toc-resources-for-r"><span class="toc-section-number">17.1</span> Resources for R</a></li>
<li><a href="resources.html#resources-for-git-github" id="toc-resources-for-git-github"><span class="toc-section-number">17.2</span> Resources for Git &amp; Github</a></li>
<li><a href="resources.html#scientific-figures" id="toc-scientific-figures"><span class="toc-section-number">17.3</span> Scientific figures</a></li>
<li><a href="resources.html#writing" id="toc-writing"><span class="toc-section-number">17.4</span> Writing</a></li>
<li><a href="resources.html#presentations" id="toc-presentations"><span class="toc-section-number">17.5</span> Presentations</a></li>
<li><a href="resources.html#professional-advice" id="toc-professional-advice"><span class="toc-section-number">17.6</span> Professional advice</a></li>
<li><a href="resources.html#funding" id="toc-funding"><span class="toc-section-number">17.7</span> Funding</a></li>
<li><a href="resources.html#ethics-and-global-health-research" id="toc-ethics-and-global-health-research"><span class="toc-section-number">17.8</span> Ethics and global health research</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/jadebc/lab-manual" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Benjamin-Chung Lab Manual</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="coding-style" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">Chapter 7</span> Coding style<a href="coding-style.html#coding-style" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>by Kunal Mishra, Jade Benjamin-Chung, and Stephanie Djajadi</p>
<div id="comments" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> Comments<a href="coding-style.html#comments" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li><strong>File Headers</strong> - Every file in a project should have a header that allows it to be interpreted on its own. It should include the name of the project and a short description for what this file (among the many in your project) does specifically. You may optionally wish to include the inputs and outputs of the script as well, though the next section makes this significantly less necessary.</li>
</ol>
<pre><code>################################################################################
# @Organization - Example Organization
# @Project - Example Project
# @Description - This file is responsible for [...]
################################################################################</code></pre>
<ol start="2" style="list-style-type: decimal">
<li><strong>File Structure</strong> - Just as your data “flows” through your project, data should flow naturally through a script. Very generally, you want to 1) source your config =&gt; 2) load all your data =&gt; 3) do all your analysis/computation =&gt; save your data. Each of these sections should be “chunked together” using comments. See <a href="https://github.com/kmishra9/Flu-Absenteeism/blob/master/Master&#39;s%20Thesis%20-%20Spatial%20Epidemiology%20of%20Influenza/2a%20-%20Statistical-Inputs.R">this file</a> for a good example of how to cleanly organize a file in a way that follows this “flow” and functionally separate pieces of code that are doing different things.
<ul>
<li><strong>Note</strong>: If your computer isn’t able to handle this workflow due to RAM or requirements, modifying the ordering of your code to accomodate it won’t be ultimately helpful and your code will be fragile, not to mention less readable and messy. You need to look into high-performance computing (HPC) resources in this case.</li>
</ul></li>
<li><strong>Single-Line Comments</strong> - Commenting your code is an important part of reproducibility and helps document your code for the future. When things change or break, you’ll be thankful for comments. There’s no need to comment excessively or unnecessarily, but a comment describing what a large or complex chunk of code does is always helpful. See <a href="https://github.com/kmishra9/Flu-Absenteeism/blob/master/Master&#39;s%20Thesis%20-%20Spatial%20Epidemiology%20of%20Influenza/1b%20-%20Map-Management.R">this file</a> for an example of how to comment your code and notice that comments are always in the form of:</li>
</ol>
<p><code># This is a comment -- first letter is capitalized and spaced away from the pound sign</code></p>
<ol start="4" style="list-style-type: decimal">
<li><strong>Multi-Line Comments</strong> - Occasionally, multi-line comments are necessary. Don’t add line breaks manually to a single-line comment for the purpose of making it “fit” on the screen. Instead, in RStudio &gt; Tools &gt; Global Options &gt; Code &gt; “Soft-wrap R source files” to have lines wrap around. Format your multi-line comments like the file header from above.</li>
</ol>
</div>
<div id="line-breaks" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> Line breaks<a href="coding-style.html#line-breaks" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><p>For <code>ggplot</code> calls and <code>dplyr</code> pipelines, do not crowd single lines. Here are some nontrivial examples of “beautiful” pipelines, where beauty is defined by coherence:</p>
<pre><code># Example 1
school_names = list(
  OUSD_school_names = absentee_all %&gt;%
    filter(dist.n == 1) %&gt;%
    pull(school) %&gt;%
    unique %&gt;%
    sort,

  WCCSD_school_names = absentee_all %&gt;%
    filter(dist.n == 0) %&gt;%
    pull(school) %&gt;%
    unique %&gt;%
    sort
)</code></pre>
<pre><code># Example 2
absentee_all = fread(file = raw_data_path) %&gt;%
  mutate(program = case_when(schoolyr %in% pre_program_schoolyrs ~ 0,
                             schoolyr %in% program_schoolyrs ~ 1)) %&gt;%
  mutate(period = case_when(schoolyr %in% pre_program_schoolyrs ~ 0,
                            schoolyr %in% LAIV_schoolyrs ~ 1,
                            schoolyr %in% IIV_schoolyrs ~ 2)) %&gt;%
  filter(schoolyr != &quot;2017-18&quot;)</code></pre>
<p>And of a complex <code>ggplot</code> call:</p>
<pre><code># Example 3
ggplot(data=data,
       mapping=aes_string(x=&quot;year&quot;, y=&quot;rd&quot;, group=group)) +

  geom_point(mapping=aes_string(col=group, shape=group),
             position=position_dodge(width=0.2),
             size=2.5) +

  geom_errorbar(mapping=aes_string(ymin=&quot;lb&quot;, ymax=&quot;ub&quot;, col=group),
                position=position_dodge(width=0.2),
                width=0.2) +

  geom_point(position=position_dodge(width=0.2),
             size=2.5) +

  geom_errorbar(mapping=aes(ymin=lb, ymax=ub),
                position=position_dodge(width=0.2),
                width=0.1) +

  scale_y_continuous(limits=limits,
                     breaks=breaks,
                     labels=breaks) +

  scale_color_manual(std_legend_title,values=cols,labels=legend_label) +
  scale_shape_manual(std_legend_title,values=shapes, labels=legend_label) +
  geom_hline(yintercept=0, linetype=&quot;dashed&quot;) +
  xlab(&quot;Program year&quot;) +
  ylab(yaxis_lab) +
  theme_complete_bw() +
  theme(strip.text.x = element_text(size = 14),
        axis.text.x = element_text(size = 12)) +
  ggtitle(title)</code></pre>
<p>Imagine (or perhaps mournfully recall) the mess that can occur when you don’t strictly style a complicated <code>ggplot</code> call. Trying to fix bugs and ensure your code is working can be a nightmare. Now imagine trying to do it with the same code 6 months after you’ve written it. Invest the time now and reap the rewards as the code practically explains itself, line by line.</p></li>
</ul>
</div>
<div id="automated-tools-for-style-and-project-workflow" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> Automated Tools for Style and Project Workflow<a href="coding-style.html#automated-tools-for-style-and-project-workflow" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="styling" class="section level3 hasAnchor" number="7.3.1">
<h3><span class="header-section-number">7.3.1</span> Styling<a href="coding-style.html#styling" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li><p><strong>Code Autoformatting</strong> - RStudio includes a fantastic built-in utility (keyboard shortcut: <code>CMD-Shift-A</code>) for autoformatting highlighted chunks of code to fit many of the best practices listed here. It generally makes code more readable and fixes a lot of the small things you may not feel like fixing yourself. Try it out as a “first pass” on some code of yours that <em>doesn’t</em> follow many of these best practices!</p></li>
<li><p><strong>Assignment Aligner</strong> - A <a href="https://www.r-bloggers.com/align-assign-rstudio-addin-to-align-assignment-operators/">cool R package</a> allows you to very powerfully format large chunks of assignment code to be much cleaner and much more readable. Follow the linked instructions and create a keyboard shortcut of your choosing (recommendation: <code>CMD-Shift-Z</code>). Here is an example of how assignment aligning can dramatically improve code readability:</p></li>
</ol>
<pre><code># Before
OUSD_not_found_aliases = list(
  &quot;Brookfield Village Elementary&quot; = str_subset(string = OUSD_school_shapes$schnam, pattern = &quot;Brookfield&quot;),
  &quot;Carl Munck Elementary&quot; = str_subset(string = OUSD_school_shapes$schnam, pattern = &quot;Munck&quot;),
  &quot;Community United Elementary School&quot; = str_subset(string = OUSD_school_shapes$schnam, pattern = &quot;Community United&quot;),
  &quot;East Oakland PRIDE Elementary&quot; = str_subset(string = OUSD_school_shapes$schnam, pattern = &quot;East Oakland Pride&quot;),
  &quot;EnCompass Academy&quot; = str_subset(string = OUSD_school_shapes$schnam, pattern = &quot;EnCompass&quot;),
  &quot;Global Family School&quot; = str_subset(string = OUSD_school_shapes$schnam, pattern = &quot;Global&quot;),
  &quot;International Community School&quot; = str_subset(string = OUSD_school_shapes$schnam, pattern = &quot;International Community&quot;),
  &quot;Madison Park Lower Campus&quot; = &quot;Madison Park Academy TK-5&quot;,
  &quot;Manzanita Community School&quot; = str_subset(string = OUSD_school_shapes$schnam, pattern = &quot;Manzanita Community&quot;),
  &quot;Martin Luther King Jr Elementary&quot; = str_subset(string = OUSD_school_shapes$schnam, pattern = &quot;King&quot;),
  &quot;PLACE @ Prescott&quot; = &quot;Preparatory Literary Academy of Cultural Excellence&quot;,
  &quot;RISE Community School&quot; = str_subset(string = OUSD_school_shapes$schnam, pattern = &quot;Rise Community&quot;)
)</code></pre>
<pre><code># After
OUSD_not_found_aliases = list(
  &quot;Brookfield Village Elementary&quot;      = str_subset(string = OUSD_school_shapes$schnam, pattern = &quot;Brookfield&quot;),
  &quot;Carl Munck Elementary&quot;              = str_subset(string = OUSD_school_shapes$schnam, pattern = &quot;Munck&quot;),
  &quot;Community United Elementary School&quot; = str_subset(string = OUSD_school_shapes$schnam, pattern = &quot;Community United&quot;),
  &quot;East Oakland PRIDE Elementary&quot;      = str_subset(string = OUSD_school_shapes$schnam, pattern = &quot;East Oakland Pride&quot;),
  &quot;EnCompass Academy&quot;                  = str_subset(string = OUSD_school_shapes$schnam, pattern = &quot;EnCompass&quot;),
  &quot;Global Family School&quot;               = str_subset(string = OUSD_school_shapes$schnam, pattern = &quot;Global&quot;),
  &quot;International Community School&quot;     = str_subset(string = OUSD_school_shapes$schnam, pattern = &quot;International Community&quot;),
  &quot;Madison Park Lower Campus&quot;          = &quot;Madison Park Academy TK-5&quot;,
  &quot;Manzanita Community School&quot;         = str_subset(string = OUSD_school_shapes$schnam, pattern = &quot;Manzanita Community&quot;),
  &quot;Martin Luther King Jr Elementary&quot;   = str_subset(string = OUSD_school_shapes$schnam, pattern = &quot;King&quot;),
  &quot;PLACE @ Prescott&quot;                   = &quot;Preparatory Literary Academy of Cultural Excellence&quot;,
  &quot;RISE Community School&quot;              = str_subset(string = OUSD_school_shapes$schnam, pattern = &quot;Rise Community&quot;)
)</code></pre>
<ol start="3" style="list-style-type: decimal">
<li><strong>StyleR</strong> - Another <a href="https://www.tidyverse.org/articles/2017/12/styler-1.0.0/">cool R package from the Tidyverse</a> that can be powerful and used as a first pass on entire projects that need refactoring. The most useful function of the package is the <code>style_dir</code> function, which will style all files within a given directory. See the <a href="https://www.rdocumentation.org/packages/styler/versions/1.1.0/topics/style_dir">function’s documentation</a> and the vignette linked above for more details.
<ul>
<li><strong>Note</strong>: The default Tidyverse styler is subtly different from some of the things we’ve advocated for in this document. Most notably we differ with regards to the assignment operator (<code>&lt;-</code> vs <code>=</code>) and number of spaces before/after “tokens” (i.e. Assignment Aligner add spaces before <code>=</code> signs to align them properly). For this reason, we’d recommend the following: <code>style_dir(path = ..., scope = "line_breaks", strict = FALSE)</code>. You can also customize StyleR <a href="http://styler.r-lib.org/articles/customizing_styler.html">even more</a> if you’re really hardcore.</li>
<li><strong>Note</strong>: As is mentioned in the package vignette linked above, StyleR modifies things <em>in-place</em>, meaning it overwrites your existing code and replaces it with the updated, properly styled code. This makes it a good fit on projects <em>with version control</em>, but if you don’t have backups or a good way to revert back to the intial code, I wouldn’t recommend going this route.</li>
</ul></li>
<li><strong>Linter</strong> - Linters are programming tools that check adherence to a given style, syntax errors, and possible semantic issues. The R linter, called <code>lintr</code>, can be found in this <a href="https://www.rdocumentation.org/packages/lintr/versions/1.0.3">package</a>. It helps keep files consistent across different authors and even different organizations. For example, it notifies you if you have unused variables, global variables with no visible binding, not enough or superflous whitespace, and improper use of parentheses or brackets. A list of its other purposes can be found <a href="https://cran.r-project.org/web/packages/lintr/readme/README.html#available-linters">in this link</a>, and most guidelines are based on <a href="http://r-pkgs.had.co.nz/style.html">Hadley Wickham’s R Style Guide</a>.
<ul>
<li><strong>Note</strong>: You can customize your settings to set defaults or to exclude files. More details can be found <a href="https://cran.r-project.org/web/packages/lintr/readme/README.html#project-configuration">here</a>.</li>
<li><strong>Note</strong>: The <code>lintr</code> package goes hand in hand with the <code>styler</code> package. The styler can be used to automatically fix the problems that the lintr catches.</li>
</ul></li>
</ol>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="coding-practices.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="working-with-big-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jadebc/lab-manual/edit/master/06-coding-style.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["lab-manual.pdf", "lab-manual.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
